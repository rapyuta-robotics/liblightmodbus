<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblightmodbus: Building and integrating liblightmodbus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liblightmodbus
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">A lightweight, header-only, cross-platform Modbus RTU/TCP library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('building.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building and integrating liblightmodbus </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Since the version v3.0, liblightmodbus is a header-only library. This decision was made due to large number of questions and problems regarding compilation on different platforms. As it turns out, CMake doesn't go very well with embedded projects.</p>
<p>In order to integrate liblightmodbus with your project you need to add <code>liblightmodbus/include</code> to you include paths. If you're using CMake you might do that automatically by including <code>lightmodbus</code> package.</p>
<p>In your source code you should be using <code>#include &lt;<a class="el" href="lightmodbus_8h.html" title="The main library header file (include this one)">lightmodbus/lightmodbus.h</a>&gt;</code> to include the library. The library can be configured by defining certain macros before including that file: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Macro   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_IMPL</code>   </td><td class="markdownTableBodyNone">Include implementation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_SLAVE</code>   </td><td class="markdownTableBodyNone">Includes slave part of the library    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_SLAVE_FULL</code>   </td><td class="markdownTableBodyNone">Enables support for all functions in slave    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_MASTER</code>   </td><td class="markdownTableBodyNone">Includes master part of the library    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_MASTER_FULL</code>   </td><td class="markdownTableBodyNone">Enables support for all functions in master    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_FULL</code>   </td><td class="markdownTableBodyNone">Includes both slave and master modules and all of their functions    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_DEBUG</code>   </td><td class="markdownTableBodyNone">Includes some debugging utilities    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_MASTER_OMIT_REQUEST_CRC</code>   </td><td class="markdownTableBodyNone">Omits request CRC calculation for request on master side    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_WARN_UNUSED</code>   </td><td class="markdownTableBodyNone">Compiler attribute to warn about unused return value. <code>__attribute__((warn_unused_result))</code> by default    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LIGHTMODBUS_ALWAYS_INLINE</code>   </td><td class="markdownTableBodyNone">Compiler attribute to always inline a function. <code>__attribute__((always_inline))</code> by default   </td></tr>
</table>
<p>Specific master/slave functions can be enabled by defining macros like <code>LIGHTMODBUS_F01M</code> or <code>LIGHTMODBUS_F22S</code>. Defining these affects contents of <a class="el" href="master_8impl_8h.html#ab7ae0464095b7a5f02a0dcb0643145f8">modbusMasterDefaultFunctions</a> and <a class="el" href="slave_8impl_8h.html#a0c75d5358eca0b3d71261269c55870d3">modbusSlaveDefaultFunctions</a> arrays.</p>
<p>Each time <code><a class="el" href="lightmodbus_8h.html" title="The main library header file (include this one)">lightmodbus.h</a></code> is included, the set of defined configuration macros must be the same (except from <code>LIGHTMODBUS_IMPL</code> which should only be used <b>once</b>).</p>
<p>Moreover, it's very important that you include implementation of the library functions (<code>LIGHTMODBUS_IMPL</code>) in <b>exactly one</b> place in your codebase. It may be a good idea to create a source file dedicated specifically for including implementation of liblightmodbus. For instance, you may want to create <code>lightmodbus-impl.c</code> containing: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;my-consistent-liblightmodbus-config-macros.h&quot;</span></div>
<div class="line"><span class="preprocessor">#define LIGHTMODBUS_IMPL</span></div>
<div class="line"><span class="preprocessor">#include &lt;lightmodbus/lightmodbus.h&gt;</span></div>
</div><!-- fragment --><p>See example integration of liblightmodbus with a simple project <a href="https://github.com/Jacajack/liblightmodbus/tree/master/examples/integration">here</a>.</p>
<h1><a class="anchor" id="embedded"></a>
Embedded platforms</h1>
<p>Since v3.0 building liblightmodbus on embedded platforms is no different from building it on your PC. You're only required to add the header files to your project.</p>
<dl class="section note"><dt>Note</dt><dd>Tip: Be sure to enable linking time optimizations (<code>-flto</code>) when building your project to further reduce the size of your binary. If your compiler doesn't support it, you can also use <code>-ffunction-sections -fdata-sections -Wl,--gc-sections</code> to delete unused functions.</dd></dl>
<h1><a class="anchor" id="ESP-IDF"></a>
ESP-IDF</h1>
<p>Liblightmodbus can be used as an ESP-IDF component. The relevant configuration is kept on <a href="https://github.com/Jacajack/liblightmodbus/tree/esp-idf"><code>esp-idf</code></a> branch and can be cloned directly to your components directory using: </p><div class="fragment"><div class="line">git clone --single-branch --branch esp-idf https://github.com/Jacajack/liblightmodbus.git</div>
</div><!-- fragment --><p>When using liblightmodbus with ESP-IDF, the implementation of the library functions is automatically included for you - you shouldn't use <code>LIGHTMODBUS_IMPL</code> anywhere in your code. You shouldn't define any config options when including <code><a class="el" href="lightmodbus_8h.html" title="The main library header file (include this one)">lightmodbus.h</a></code> either. Library configuration is read from <code>esp.config.h</code> and <code>sdkconfig.h</code> and should be edited with <code>idf.py menuconfig</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
